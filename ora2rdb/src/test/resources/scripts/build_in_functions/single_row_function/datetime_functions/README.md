--------------------------------

Тестирование встроенных функций для работы с датой и временем.

DUAL — это специальная виртуальная таблица, которая используется для выполнения запросов, когда вам не нужно работать с данными из реальной таблицы, а нужно просто выполнить выражение или вычисление. Эта таблица существует по умолчанию в базе данных Oracle и всегда содержит одну строку и один столбец.

--------------------------------

### ADD_MONTHS

```sql  
  ADD_MONTHS(date, integer)
```

Возвращает значение DATE, полученное в результате увеличения заданного значения DATE на заданное количество месяцев.
Если дата — последний день месяца или если полученный месяц имеет меньше дней, чем исходная дата, то результатом является последний день полученного месяца. В противном случае результат имеет тот же день, что и дата.

В РБД такой функции нет, но ее можно заменить:

```sql 
  DATEADD(MONTH, integer, date)
```

--------------------------------

### CURRENT_DATE

```sql 
  CURRENT_DATE
```

CURRENT_DATE возвращает текущую дату в часовом поясе сеанса в значении по григорианскому календарю типа данных DATE.

В РБД есть контекстная переменная CURRENT_DATE

--------------------------------

### CURRENT_TIMESTAMP

```sql 
  CURRENT_TIMESTAMP [(precision)]
```

Возвращает текущую дату и время в часовом поясе сеанса как значение типа TIMESTAMP WITH TIME ZONE. 
В необязательном аргументе precision указывает точность возвращаемого значения времени в долях секунды. Максимальная точность - 9 знаков

В РБД есть аналогичная контекстная переменная CURRENT_TIMESTAMP, но максимальная точность там - 3 знака. Поэтому при конвертации значения precision больше 3 нужно конвертировать в 3.

--------------------------------

### DBTIMEZONE

```sql 
  DBTIMEZONE
```

Возвращает значение часового пояса базы данных, точнее смещение часового пояса базы данных относительно UTC
в форме символьной строки '[+|-]TZH:TZM' (например, '-05:00'). 

В РБД нет такой функции или контекстной переменной.

--------------------------------

### EXTRACT 

```sql 
    EXTRACT( { YEAR
             | MONTH
             | DAY
             | HOUR
             | MINUTE
             | SECOND
             | TIMEZONE_HOUR
             | TIMEZONE_MINUTE
             | TIMEZONE_REGION
             | TIMEZONE_ABBR
             }
             FROM  {дата_время | интервал}
           )
```

Функция `EXTRACT` используется для извлечения компонентов из значения даты/времени или интервала (заданного типами данных `INTERVAL YEAR TO MONTH` или `INTERVAL DAY TO SECOND`).

Аналогичная функция есть в РБД:

```sql 
    EXTRACT ({ YEAR
             | MONTH
             | DAY
             | HOUR
             | MINUTE
             | SECOND
             | TIMEZONE_HOUR
             | TIMEZONE_MINUTE
             } 
             FROM <дата_время>)
```

В РБД нет типа данных интервалов, поэтому конвертировать не получится.

Извлечь TIMEZONE_REGION и TIMEZONE_ABBR тоже не получится. 

**В Оракле возвращаются значения в часовом поясе базы данных, а в РБД в часовом поясе сессии.** Результаты могут отличаться.

--------------------------------

### FROM_TZ

```sql 
  FROM_TZ(timestamp_value, time_zone_value)
```

Преобразует TIMESTAMP и данные часового пояса в значение типа TIMESTAMP WITH TIME ZONE.

time_zone_value — это строка символов в формате «TZH:TZM» или символьное выражение, которое возвращает строку в формате TZR.

Аналогичная функция есть в РБД:

```sql 
  timestamp_value AT TIME ZONE time_zone_value
```

**В положительное значение time_zone_value надо обязательно добавлять знак "+"**

--------------------------------

### LAST_DAY

```sql 
  LAST_DAY(date)
```

Возвращает дату последнего дня месяца для заданного входного значения DATE.

Аналогичная функция есть в РБД:

```sql 
  LAST_DAY( OF MONTH FROM date )
```

--------------------------------

### LOCALTIMESTAMP

```sql 
  LOCALTIMESTAMP[(timestamp_precision)]
```

Возвращает текущую дату и время как значение типа TIMESTAMP в локальном часовом поясе (часовом поясе сессии).

Разница между этой функцией и CURRENT_TIMESTAMP заключается в том, что LOCALTIMESTAMP возвращает значение TIMESTAMP, тогда как CURRENT_TIMESTAMP возвращает значение TIMESTAMP WITH TIME ZONE.

В необязательном аргументе timestamp_precision указывает точность возвращаемого значения времени в долях секунды. Максимальная точность - 9 знаков

Аналогичная контекстная переменная есть в РБД, но максимальная точность там - 3 знака. :

```sql 
  LOCALTIMESTAMP[(timestamp_precision)]
```
Поэтому при конвертации значения precision больше 3 нужно конвертировать в 3.

--------------------------------

### MONTHS_BETWEEN

```sql 
  MONTHS_BETWEEN(date1, date2)
```

Возвращает количество месяцев между датами date1 и date2.
- Если date1 позже date2, то результат положительный. 
- Если date1 раньше date2, то результат отрицательный. 
- Если date1 и date2 являются либо одними и теми же днями месяцев, либо оба последними днями месяцев, то результат всегда будет целым числом. 
- В противном случае Oracle Database вычисляет дробную часть результата на основе 31-дневного месяца и учитывает разницу во временных компонентах date1 и date2.

Подобная функция есть в РБД:

```sql 
  DATEDIFF(MONTH, date1, date2)
```

Но тут есть существенная разница:

- в РБД возвращается всегда целое число, а в оракле-дробное.
- Если date1 позже date2, то результат отрицательный. 
- Если date1 раньше date2, то результат положительный. 

Вывод: функция работает не как в оракле. Ее надо конвертировать.

--------------------------------

### NEW_TIME

```sql 
  NEW_TIME(date, timezone1, timezone2)
```

Преобразует значение типа DATE часового пояса timezone1 в аналогичное значение другого пояса timezone2. 

Аргументы timezone1 и timezone2 могут быть любыми из следующих текстовых строк:
AST, ADT: Atlantic Standard or Daylight Time
BST, BDT: Bering Standard or Daylight Time
CST, CDT: Central Standard or Daylight Time
EST, EDT: Eastern Standard or Daylight Time
GMT: Greenwich Mean Time
HST, HDT: Alaska-Hawaii Standard Time or Daylight Time.
MST, MDT: Mountain Standard or Daylight Time
NST: Newfoundland Standard Time
PST, PDT: Pacific Standard or Daylight Time
YST, YDT: Yukon Standard or Daylight Time

Аналогичной функции нет.

--------------------------------

### NEXT_DAY

```sql 
  NEXT_DAY(date, char)
```

Возвращает дату дня недели, названного char, который идет сразу после даты date. Тип возвращаемого значения всегда DATE, независимо от типа данных date. Аргумент char должен быть днем ​​недели на языке даты вашего сеанса, либо полным именем, либо аббревиатурой. Минимальное требуемое количество букв равно количеству букв в сокращенной версии. Любые символы, следующие сразу за допустимой аббревиатурой, игнорируются. Возвращаемое значение имеет те же компоненты часов, минут и секунд, что и аргумент date.

Аналогичной функции нет.

--------------------------------

### NUMTODSINTERVAL

```sql 
  NUMTODSINTERVAL(n, 'interval_unit')
```

Преобразует заданное количество дней, часов, минут или секунд (на ваш выбор) в значение типа INTERVAL DAY TO SECOND.

Значение для interval_unit указывает единицу измерения n и может принимать одно из следующих строковых значений: 'DAY', 'HOUR', 'MINUTE', 'SECOND'.

Подобного типа (INTERVAL DAY TO SECOND) в РБД нет.

--------------------------------

### NUMTOYMINTERVAL

```sql 
  NUMTOYMINTERVAL(n, 'interval_unit')
```

Преобразует заданное количество годов и месяцев (на ваш выбор) в значение типа INTERVAL YEAR TO MONTH.

Значение для interval_unit указывает единицу измерения n и может принимать одно из следующих строковых значений: 'YEAR','MONTH'.

--------------------------------

### ORA_DST_AFFECTED

```sql 
  ORA_DST_AFFECTED(datetime_expr)
```

Функция ORA_DST_AFFECTED полезна, когда вы изменяете файл данных временной зоны для вашей базы данных. Эта функция принимает в качестве аргумента выражение даты и времени, которое разрешается в значение TIMESTAMP WITH TIME ZONE или объект VARRAY, содержащий значения TIMESTAMP WITH TIME ZONE. Функция возвращает 1, если значение даты и времени затрагивается или приведет к ошибке "несуществующее время" или "дублирующееся время" с новыми данными временной зоны. В противном случае она возвращает 0.

Эта функция может быть вызвана только при изменении файла данных временной зоны базы данных и обновлении временной метки с данными временной зоны, и только между выполнением процедур DBMSDST.BEGINPREPARE и DBMSDST.ENDPREPARE или между выполнением процедур DBMSDST.BEGINUPGRADE и DBMSDST.ENDUPGRADE.

Не конвертируется.

--------------------------------

### ORA_DST_CONVERT

```sql 
  ORA_DST_CONVERT(datetime_expr [, integer [, integer ]])
```

ORA_DST_CONVERT полезна при изменении файла данных временной зоны для вашей базы данных. Эта функция позволяет вам указать обработку ошибок для заданного выражения даты и времени.

Опциональный второй аргумент определяет обработку ошибок "дублирующегося времени". Укажите 0 (ложь), чтобы подавить ошибку, вернув исходное значение даты и времени. Это значение по умолчанию. Укажите 1 (истина), чтобы разрешить базе данных вернуть ошибку дублирующегося времени.

Опциональный третий аргумент определяет обработку ошибок "несуществующего времени". Укажите 0 (ложь), чтобы подавить ошибку, вернув исходное значение даты и времени. Это значение по умолчанию. Укажите 1 (истина), чтобы разрешить базе данных вернуть ошибку несуществующего времени.

Эту функцию можно вызывать только при изменении файла данных временной зоны базы данных и обновлении временной метки с данными временной зоны, и только между выполнением процедур DBMSDST.BEGINUPGRADE и DBMSDST.ENDUPGRADE.

Не конвертируется.

--------------------------------

### ORA_DST_ERROR

```sql 
  ORA_DST_ERROR(datetime_expr)
```

Функция ORA_DST_ERROR полезна при изменении файла данных часового пояса для вашей базы данных. Функция принимает в качестве аргумента выражение datetime, и указывает, приведет ли это значение времени к ошибке с новыми данными часового пояса. Возможные возвращаемые значения:

0: значение времени не приведет к ошибке с новыми данными часового пояса.

1878: значение времени приведет к ошибке "несуществующее время".

1883: значение времени приведет к ошибке "дублирующееся время".

Эту функцию можно вызвать только при изменении файла данных часового пояса базы данных и обновлении данных метки времени с учетом часового пояса, и только между выполнением процедур DBMS_DST.BEGIN_PREPARE и DBMS_DST.END_PREPARE или между выполнением процедур DBMS_DST.BEGIN_UPGRADE и DBMS_DST.END_UPGRADE.

Не конвертируется.

--------------------------------

### ROUND 

```sql 
  ROUND(date [, format])
```

Возвращает значение типа DATE, округленное до заданных единиц (format мб 'day', 'month', 'year'). 
Если format опущен, дата округляется до ближайшего дня. 

Ниже приведены допустимые параметры format:

- `CC, SCC` -- На единицу больше первых двух цифр четырехзначного года
- `SYYYY, YYYY, YEAR, SYEAR, YYY, YY, Y` -- округление до ближайшего года
- `IYYY, IY, IY, I` -- Year containing the calendar week, as defined by the ISO 8601 standard
- `Q` -- Quarter (rounds up on the sixteenth day of the second month of the quarter)
- `MONTH, MON, MM, RM` - Month (rounds up on the sixteenth day)
- `WW` -- Same day of the week as the first day of the year
- `IW` -- Same day of the week as the first day of the calendar week as defined by the ISO 8601 standard, which is Monday
- `W` -- Same day of the week as the first day of the month
- `DDD, DD, J` -- округление до дня
- `DAY, DY, D` -- округление до первого дня недели 
- `HH, HH12, HH24` -- округление до часу
- `MI` -- округление до минут

Аналогичной функции нет.

--------------------------------

### SESSIONTIMEZONE

```sql 
  SESSIONTIMEZONE
```

Возвращает смещение часового пояса сеанса (относительно UTC) в форме символьной строки.

В РДБ есть контекстная переменная `SESSION_TIMEZONE` в пространстве имен `SYSTEM`.

```sql 
  RDB$GET_CONTEXT('SYSTEM', 'SESSION_TIMEZONE')
```

--------------------------------

### SYS_EXTRACT_UTC

```sql 
  SYS_EXTRACT_UTC(datetime_with_timezone)
```

Преобразует значение типа TIMESTAMP WITH TIME ZONE в значение TIMESTAMP с той же датой и временем, нормализованное по времени UTC. Если часовой пояс не указан, то преобразование происходит в часовой пояс сессии.

В РБД можно преобразовать с помощью функции AT TIME ZONE 'UTC':

```sql 
  datetime_with_timezone AT TIME ZONE 'UTC'
```

--------------------------------

### SYSDATE

```sql 
  SYSDATE
```

Возвращает текущую дату и время сервера Oracle как значение типа DATE **в часовом поясе БД**.

В РБД есть контекстная переменная CURRENT_DATE, но она **возвращает время в часовом поясе сессии**.

--------------------------------

### SYSTIMESTAMP

```sql 
  SYSTIMESTAMP
```

Возвращает текущую дату и время сервера Oracle как значение типа TIMESTAMP WITH TIME ZONE **в часовом поясе БД**.

В РБД есть контекстная переменная CURRENT_TIMESTAMP, но она **возвращает время в часовом поясе сессии**.

--------------------------------

### TO_CHAR 

```sql
  TO_CHAR({ datetime | interval } [, fmt [, 'nlsparam' ] ])
```

Преобразует значение даты/времени в символьную строку.

fmt можно найти по ссылке: https://docs.oracle.com/en/database/oracle/oracle-database/21/sqlrf/Format-Models.html#GUID-22F2B830-261E-4BF0-91FB-6A1DAFC6D0A3

В РБД для преобразования datetime в строку используется функция CAST:

```sql
  CAST(<значение> AS VARCHAR FORMAT <шаблон>)
```

Значения типа INTERVAL YEAR TO MONTH или INTERVAL DAY TO SECOND не конвертируются.
nlsparam который имеет форму 'NLS_DATE_LANGUAGE = language'  не конвертируется.

**Формат дробных секунд FF или xFF нужно заменять на FF9 или .FF9 соответственно**

--------------------------------

### TO_DSINTERVAL

```sql
  TO_DSINTERVAL ( ' { sql_format | ds_iso_format } ' 
                [ DEFAULT return_value ON CONVERSION ERROR ] )
```

Преобразует символьную строку в значение типа INTERVAL DAY TO SECOND.

В РБД нет аналогичного типа INTERVAL DAY TO SECOND.
Не конвертируются.

--------------------------------

### TO_TIMESTAMP

```sql
  TO_TIMESTAMP(char [ DEFAULT return_value ON CONVERSION ERROR ]
              [, fmt [, 'nlsparam' ] ])
```

Преобразует символьную строку в значение типа TIMESTAMP.

Необязательное предложение `DEFAULT return_value ON CONVERSION ERROR` позволяет указать значение, которое возвращает эта функция, если при преобразовании char в TIMESTAMP возникает ошибка. Это предложение не имеет эффекта, если при вычислении char возникает ошибка. 

Необязательный параметр fmt определяет формат char. Если параметр fmt опущен, то char должен быть в формате по умолчанию типа данных TIMESTAMP, который определяется параметром инициализации NLS_TIMESTAMP_FORMAT. 

Необязательный аргумент 'nlsparam' имеет то же назначение в этой функции, что и в функции TO_CHAR для преобразования даты.
nlsparam который имеет форму 'NLS_DATE_LANGUAGE = language'  не конвертируется.

В РБД для преобразования строки в datetime используется функция CAST:

```sql
  CAST(<значение> AS TIMESTAMP WITHOUT TIME ZONE FORMAT <шаблон>)
```

**Дробные секунды в РБД можно указывать только до 4 знаков после запятой**

**Формат дробных секунд FF или xFF нужно заменять на FF4 или .FF4 соответственно**

--------------------------------

### TO_TIMESTAMP_TZ

```sql
  TO_TIMESTAMP_TZ(char [ DEFAULT return_value ON CONVERSION ERROR ]
                 [, fmt [, 'nlsparam' ] ])
```

Преобразует символьную строку в значение типа TIMESTAMP WITH TIME ZONE.

Необязательное предложение `DEFAULT return_value ON CONVERSION ERROR` позволяет указать значение, которое возвращает эта функция, если при преобразовании char в TIMESTAMP WITH TIME ZONE возникает ошибка. Это предложение не имеет эффекта, если при вычислении char возникает ошибка. 

Необязательный параметр fmt определяет формат char. Если параметр fmt опущен, то char должен быть в формате по умолчанию типа данных TIMESTAMP WITH TIME ZONE, который определяется параметром инициализации NLS_TIMESTAMP_FORMAT. 

Необязательный аргумент 'nlsparam' имеет то же назначение в этой функции, что и в функции TO_CHAR для преобразования даты.
nlsparam который имеет форму 'NLS_DATE_LANGUAGE = language'  не конвертируется.

В РБД для преобразования строки в datetime используется функция CAST:

```sql
  CAST(<значение> AS TIMESTAMP WITH TIME ZONE FORMAT <шаблон>)
```

**Дробные секунды в РБД можно указывать только до 4 знаков после запятой**

**Формат дробных секунд FF или xFF нужно заменять на FF4 или .FF4 соответственно**

**Если часовой пояс указан как 8:00, то в РБД надо добавлять знак +, т.е. +8:00**

--------------------------------

### TO_YMINTERVAL

```sql
  TO_YMINTERVAL
    ( '  { [+|-] years - months 
        | ym_iso_format 
        } '
      [ DEFAULT return_value ON CONVERSION ERROR ]
    )
```

Преобразует символьную строку в значение типа INTERVAL YEAR TO MONTH.
В РБД нет аналогичного типа INTERVAL YEAR TO MONTH.
Не конвертируются.

--------------------------------

### TRUNC 

```sql
  TRUNC(date [, fmt ])
```

Возвращает значение типа DATE, усеченное до заданных единиц в соответствии в форматом fmt.
Если fmt опущен, то используется модель формата по умолчанию 'DD', а возвращаемое значение представляет собой дату, усеченную до дня со временем - полночь.

В РДБ нет подобной функции. 

Для формата недели, месяца и года эту функцию можно конвертировать в `FIRST_DAY(OF {YEAR | MONTH | WEEK} FROM date)`.

**Не путать с TRUNC для чисел**

--------------------------------

### TZ_OFFSET

```sql
  TZ_OFFSET({ 'time_zone_name'
            | '{ + | - } hh : mi'
            | SESSIONTIMEZONE
            | DBTIMEZONE
            }
           )
```

Возвращает смещение относительно UTC часового пояса, заданного названием или сокращением, в форме VARCHAR2 (например, '-05:00')


--------------------------------